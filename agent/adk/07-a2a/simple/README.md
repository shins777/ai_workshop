# A2A 기본 샘플 에이전트

이 샘플은 에이전트 개발 키트(ADK)의 **에이전트 간 통신(Agent-to-Agent, A2A)** 아키텍처를 보여줍니다. 여러 에이전트가 협력하여 복잡한 작업을 처리하는 방법을 보여주며, 구체적으로 주사위를 굴리고 숫자가 소수인지 확인하는 에이전트를 구현합니다.

## 개요

A2A 기본 샘플은 다음과 같이 구성됩니다:

- **Root Agent** (`root_agent`): 마스터 오케스트레이터로, 사용자 요청에 따라 전문 서브 에이전트들에게 작업을 할당합니다.
- **Roll Agent** (`roll_agent`): 로컬 서브 에이전트로, 주사위 굴리기 작업을 처리합니다.
- **Prime Agent** (`prime_agent`): 원격 A2A 에이전트로, 숫자가 소수인지 확인합니다. 이 에이전트는 별도의 A2A 서버에서 실행됩니다.

## 아키텍처

```
┌─────────────────┐    ┌──────────────────┐    ┌────────────────────┐
│   Root Agent    │───▶│   Roll Agent     │    │   Remote Prime     │
│    (로컬)       │    │    (로컬)       │    │     에이전트       │
│                 │    │                  │    │  (localhost:8001)  │
│                 │───▶│                  │◀───│                    │
└─────────────────┘    └──────────────────┘    └────────────────────┘
```

## 주요 특징

### 1. **로컬 서브 에이전트 통합**
- `roll_agent`는 로컬 서브 에이전트를 생성하고 통합하는 방법을 보여줍니다.
- 설정 가능한 면의 수에 따라 주사위 굴리기를 처리합니다.
- 난수 생성을 위해 간단한 함수 도구(`roll_die`)를 사용합니다.

### 2. **원격 A2A 에이전트 통합**
- `prime_agent`는 원격 에이전트 서비스에 연결하는 방법을 보여줍니다.
- HTTP를 통해 `http://localhost:8001/a2a/check_prime_agent`에 있는 별도의 서비스와 통신합니다.
- 서비스 간 에이전트 통신(Cross-service agent communication)을 실현합니다.

### 3. **에이전트 오케스트레이션(Orchestration)**
- Root 에이전트는 사용자 요청에 따라 지능적으로 작업을 할당합니다.
- 작업 체이닝을 지원합니다 (예: "주사위를 굴리고 그 결과가 소수인지 확인해줘").
- 여러 에이전트 간의 명확한 워크플로우 조정을 제공합니다.

### 4. **예제 도구 통합**
- `ExampleTool`을 포함하여 에이전트가 예상되는 동작 패턴을 이해하도록 돕는 샘플 상호작용 예시를 제공합니다.

## 설정 및 사용법

### 사전 준비 사항

1. **원격 소수 판별 에이전트(Remote Prime Agent) 서버 시작**:
   ```bash
   # 8001 포트에서 소수 판별 에이전트를 서비스하는 원격 A2A 서버를 시작합니다.
   adk api_server --a2a --port 8001 simple/check_prime_agent
   ```

2. **메인 에이전트(Main Agent) 실행**:
   ```bash
   # 별도의 터미널에서 ADK 웹 서버를 실행합니다.
   adk web simple/client
   ```

### 상호작용 예시

두 서비스가 모두 실행되면 Root 에이전트와 대화할 수 있습니다:

**단순 주사위 굴리기:**
```
사용자: 6면체 주사위를 굴려줘
봇: 4가 나왔습니다.
```

**소수 판별:**
```
사용자: 7이 소수인가요?
봇: 네, 7은 소수입니다.
```

**복합 작업:**
```
사용자: 10면체 주사위를 굴리고 그 결과가 소수인지 확인해줘
봇: 8이 나왔습니다.
봇: 8은 소수가 아닙니다.
```

## 코드 구조

### 메인 에이전트 (`client/agent.py`)

- **`roll_die(sides: int)`**: 주사위를 굴리는 함수 도구
- **`roll_agent`**: 주사위 굴리기에 특화된 로컬 에이전트
- **`prime_agent`**: 원격 A2A 에이전트 설정
- **`root_agent`**: 작업 할당 로직을 가진 메인 오케스트레이터

### 원격 소수 판별 에이전트 (`check_prime_agent/`)

- **`agent.py`**: 소수 판별 서비스의 구현체
- **`agent.json`**: A2A 에이전트의 에이전트 카드(Agent Card)
- **`check_prime(nums: list[int])`**: 소수 판별 알고리즘

## 샘플 확장하기

이 샘플을 다음과 같이 확장해 볼 수 있습니다:

- 더 많은 수학적 연산 추가 (인수분해, 제곱근 등)
- 추가적인 원격 에이전트 생성
- 더 복잡한 위임 로직 구현
- 영구 상태 관리(Persistent state management) 도입
- 외부 API 또는 데이터베이스 통합

## 다른 환경에 배포하기

원격 A2A 에이전트를 다른 환경(예: Cloud Run, 다른 호스트/포트)에 배포할 때는 `agent.json` 파일의 `url` 필드를 반드시 업데이트해야 합니다:

### 로컬 개발
```json
{
  "url": "http://localhost:8001/a2a/check_prime_agent",
  ...
}
```

### Cloud Run 예시
```json
{
  "url": "https://your-service-abc123-uc.a.run.app/a2a/check_prime_agent",
  ...
}
```

### 커스텀 호스트/포트 예시
```json
{
  "url": "https://your-domain.com:9000/a2a/check_prime_agent",
  ...
}
```

**중요:** `check_prime_agent/agent.json`의 `url` 필드는 원격 A2A 에이전트가 배포되어 접근 가능한 실제 RPC 엔드포인트를 가리켜야 합니다.

## 문제 해결

**연결 문제:**
- ADK 웹 서버가 8000 포트에서 실행 중인지 확인하십시오.
- 원격 A2A 서버가 8001 포트에서 실행 중인지 확인하십시오.
- 방화벽이 localhost 연결을 차단하고 있지 않은지 확인하십시오.
- **`check_prime_agent/agent.json`의 `url` 필드가 원격 A2A 서버의 실제 배포 위치와 일치하는지 확인하십시오.**
- `RemoteA2aAgent` 생성자에 전달된 에이전트 카드 URL이 실행 중인 A2A 서버와 일치하는지 확인하십시오.

**에이전트 응답 없음:**
- 8000 포트(로컬)와 8001 포트(원격) 서버의 로그를 확인하십시오.
- 에이전트 지침(Instruction)이 명확하고 모호하지 않은지 확인하십시오.
- **`agent.json` 파일의 RPC URL이 정확하고 접근 가능한지 다시 한번 확인하십시오.**
