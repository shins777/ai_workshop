# ADK 콜백(Callback) 시스템 가이드 (06-callback)

이 디렉터리는 ADK(Agent Development Kit)의 강력한 확장 기능인 **콜백(Callback) 시스템**의 활용 예제를 통합하여 제공합니다.

콜백을 사용하면 에이전트의 사고 과정, 도구 호출, 그리고 실제 LLM과의 통신 단계 사이사이에 개입하여 데이터를 검증하고, 흐름을 동적으로 제어하며, 응답을 최적화할 수 있습니다. 이는 에이전트의 지침(Instruction)만으로는 구현하기 어려운 복잡한 비즈니스 로직이나 가드레일을 구축하는 데 필수적입니다.

## 콜백 아키텍처 개요

ADK는 실행 단계에 따라 세 가지 수준의 콜백 지점을 제공합니다.

| 수준 | 주요 용도 | 핵심 콜백 지점 |
| :--- | :--- | :--- |
| **[Agent Level](./agent_callback/)** | 에이전트 전체 실행 제어 및 수명 주기 관리 | `before_agent_callback`, `after_agent_callback` |
| **[Model Level](./model_callback/)** | 프롬프트(Request) 및 모델 응답(Response) 필터링 | `before_model_callback`, `after_model_callback` |
| **[Tool Level](./tool_callback/)** | 도구 인자(Arguments) 보정 및 실행 결과 후처리 | `before_tool_callback`, `after_tool_callback` |

---

## 어느 수준의 콜백을 사용해야 할까요?

### 1. "특정 조건에서 ए이전트 실행 자체를 막고 싶어요." ➔ **Agent Level**
- 사용자 상태나 시스템 플래그를 확인하여 LLM 호출 비용을 아끼거나 특정 흐름으로 유도할 때 적합합니다.
- 예: "현재 서비스 점검 중입니다"라는 메시지를 에이전트 실행 전 즉시 반환.

### 2. "질문이나 답변에 부적절한 단어가 포함되는 것을 방지하고 싶어요." ➔ **Model Level**
- LLM에 전달되는 원본 프롬프트나 LLM이 생성한 초기 결과물을 직접 검사해야 할 때 사용합니다.
- 예: 개인정보(PII) 누출 방지 가드레일 구현.

### 3. "모델이 도구 인자를 자꾸 틀리게 생성해요." ➔ **Tool Level**
- 특정 도구가 호출될 때만 개입하여 인자를 수정하거나, 도구의 원본 출력을 사용자 친화적으로 가공할 때 유용합니다.
- 예: 날짜 형식을 API 규격에 맞춰 변환하거나, API 결과에 설명을 덧붙임.

---

## 공통 활용 가이드

1.  **CallbackContext 활용**: 모든 콜백 함수는 에이전트 명칭, 세션 상태 등을 담은 컨텍스트 정보를 인자로 받습니다. 이를 통해 문맥에 맞는 처리가 가능합니다.
2.  **관심사 분리**: 에이전트의 '페르소나'는 `Instruction`에, '비즈니스 규칙 및 보안'은 `Callback`에 작성하여 코드의 유지보수성을 높이세요.
3.  **성능 고려**: 콜백 내에서 너무 무거운 작업(예: 외부 DB 동기 호출)을 수행하면 에이전트의 응답 속도가 느려질 수 있으니 주의가 필요합니다.

## 실행 및 테스트
각 하위 폴더의 `run.ipynb`를 통해 개별 패턴을 테스트할 수 있으며, `adk web`을 실행하여 시각적으로 이벤트 흐름을 확인할 수 있습니다.

```bash
# 06-callback 폴더에서 실행
adk web
```

## 라이선스
Apache License 2.0. Copyright 2025 Forusone.
